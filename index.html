<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>なんでもやってみるのが良いと思う</title>
  <meta name="author" content="H.Tokida">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://stepxstep.org">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="なんでもやってみるのが良いと思う" type="application/atom+xml">

  <link href="/stylesheets/data-table.css" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/toc.css" rel="stylesheet" type="text/css" />


  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://stepxstep.org">
  <meta property="og:title" content="なんでもやってみるのが良いと思う">
  <meta property="og:description" content="最近新しい技術がたくさん出ていてさっぱりついて行けないのですが頑張ってついていく記録。">

  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-477563-11', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">なんでもやってみるのが良いと思う</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/about">About</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:stepxstep.org">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="なんでもやってみるのが良いと思う" />
    <meta itemprop="description" content="最近新しい技術がたくさん出ていてさっぱりついて行けないのですが頑張ってついていく記録。" />
    <meta itemprop="url" content="http://stepxstep.org" />
      
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-03-29T19:13:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2016年3月29日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/03/29/try-ducksh/" itemprop="url">CyberduckのCli版duckを利用して簡単にクラウドストレージを利用する</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description">
<p>CyberDuckという有名なクラウドストレージクライアントがあります。最近見たところ duck.sh なるツールが登場していたので試してみました。</p>

<ul>
  <li><a href="https://duck.sh/">https://duck.sh/</a></li>
</ul>

<p>今回はMacで実施したので</p>

<pre><code>sudo brew install duck
</code></pre>

<p>で導入が出来る。</p>

<p>色々接続ができるがニーズがないであろうが SoftLayer のObject Storage (OpenStack Swift) に接続をしてみます。</p>

<pre><code>$ duck --help
Usage:duck [options...]


URLs must be fully qualified. Paths can either denote a remote file (ftps://user@example.net/resource) or folder (ftps://user@example.net/directory/) with a trailing slash. You can reference files
relative to your home directory with /~ (ftps://user@example.net/~/).
Supported protocols
ftp	FTP (File Transfer Protocol)
	ftp://&lt;hostname&gt;/&lt;folder&gt;/&lt;file&gt;
ftps	FTP-SSL (Explicit AUTH TLS)
	ftps://&lt;hostname&gt;/&lt;folder&gt;/&lt;file&gt;
sftp	SFTP (SSH File Transfer Protocol)
	sftp://&lt;hostname&gt;/&lt;folder&gt;/&lt;file&gt;
dav	WebDAV (Web-based Distributed Authoring and Versioning)
	dav://&lt;hostname&gt;/&lt;folder&gt;/&lt;file&gt;
davs	WebDAV (HTTP/SSL)
	davs://&lt;hostname&gt;/&lt;folder&gt;/&lt;file&gt;
swift	Swift (OpenStack Object Storage)
	swift://&lt;container&gt;/&lt;key&gt;
s3	S3 (Amazon Simple Storage Service)
	s3://&lt;container&gt;/&lt;key&gt;
gs	Google Cloud Storage
	gs://&lt;container&gt;/&lt;key&gt;
azure	Windows Azure Storage
	azure://&lt;container&gt;/&lt;key&gt;
rackspace	Rackspace Cloud Files (US)
	rackspace://&lt;container&gt;/&lt;key&gt;

You can install additional connection profiles in ~/Library/Application Support/Cyberduck/Profiles

    --application &lt;path&gt;                  External editor application
    --copy &lt;url&gt; &lt;url&gt;                    Copy between servers
 -d,--download &lt;url&gt; &lt;[file]&gt;             Download file or folder. Denote a folder with a trailing '/'
 -D,--delete &lt;url&gt;                        Delete
 -e,--existing &lt;action&gt;                   Transfer action for existing files
                                          Options for downloads and uploads:
                                          	Resume	Append existing files (resume)
                                          	Overwrite	Overwrite all files (overwrite)
                                          	Rename	Rename transferred files with a timestamp appended to the filename (similar)
                                          	Rename existing	Rename existing files with timestamp appended to filename (rename)
                                          	Skip	Skip transfer of files that already exist (skip)
                                          	Compare	Skip files that match size, modification date or checksum (compare)
                                          	Cancel	 (cancel)
                                          Options for synchronize:
                                          	Download	Download changed and missing files (download)
                                          	Upload	Upload changed and missing files (upload)
                                          	Mirror	Download and Upload (mirror)
                                          	Cancel	 (cancel)

    --edit &lt;url&gt;                          Edit file in external editor
 -h,--help                                Print this help
 -i,--identity &lt;private key file&gt;         Selects a file from which the identity (private key) for public key authentication is read
 -l,--list &lt;url&gt;                          List files in remote folder
 -L,--longlist                            Long list format with modification date and permission mask
 -p,--password &lt;password or secret key&gt;   Password
 -P,--preserve                            Preserve permissions and modification date for transferred files
    --parallel &lt;connections&gt;              Number of concurrent connections to use for transfers
 -q,--quiet                               Suppress progress messages
 -r,--retry &lt;count&gt;                       Retry failed connection attempts
    --region &lt;location&gt;                   Location of bucket or container
    --synchronize &lt;url&gt; &lt;directory&gt;       Synchronize folders
    --throttle &lt;bytes per second&gt;         Throttle bandwidth
 -u,--username &lt;username or access key&gt;   Username
    --udt                                 Use UDT protocol if applicable
    --upload &lt;url&gt; &lt;file&gt;                 Upload file or folder recursively
 -v,--verbose                             Print transcript
 -V,--version                             Show version number and quit
 -y,--assumeyes                           Assume yes for all prompts

Cyberduck is libre software licenced under the GPL. For general help about using Cyberduck, please refer to https://duck.sh/ and the wiki at http://help.duck.sh/. For bug reports or feature requests
open a ticket at https://trac.cyberduck.io/newticket?version=4.7.3.
Not registered. Purchase a donation key to support the development of this software.
</code></pre>

<p>プロファイルをダウンロード</p>

<ul>
  <li><a href="http://qiita.com/testnin2/items/1868f9f5775ae06afc26">http://qiita.com/testnin2/items/1868f9f5775ae06afc26</a></li>
</ul>

<p>ここに記載されているファイルを <code>~/Library/Application Support/Cyberduck/Profiles/SoftLayer_TOK02_public.cyberduckprofile</code> に保存する。これでこのプロファイルを利用できるようになります。</p>

<p>今回接続する SoftLayer 側の情報として以下のようになっているとします。</p>

<ul>
  <li>TOK2上にObjectStorageを購入</li>
  <li>tokida というContainerを作成済み</li>
  <li>SoftLayer Portalからusername,passwordを取得済み</li>
</ul>

<pre><code>$ duck --list softlayer-tok02_public://tokida/ -u "$usernaem" -p "$password"
Login successful…
.file-segments
Dropbox
a_M00xxx_2003.nsf
a_M00xxx_2004.nsf
a_M00xxx_2005.nsf
</code></pre>

<p>これだけで接続ができます。duckコマンド経由で利用することで SoftLayer Object Storageの制約である5Gなども正しくマルチパートでアップロードしてくれるので非常に便利に利用できますね。</p>

<pre><code>$ duck -u $username -p $password --upload softlayer-tok02_public://tokida/ hosts
Upload complete…
</code></pre>

<pre><code>$ duck -u $username -p $password --delete softlayer-tok02_public://tokida/hosts
Deleting hosts…
</code></pre>

<p>同期もでき、download, mirror , upload が選択できる。</p>

<pre><code>duck -u $username -p $password --synchronize softlayer-tok02_public://tokida/dotfiles ./
Login successful…
Choose what action to take:

 Cancel	 (cancel)
 Download	Download changed and missing files (download)
 Mirror	Download and Upload (mirror)
 Upload	Upload changed and missing files (upload)

Action [cancel, download, mirror, upload]: upload
</code></pre>

<p>クラウドストレージは、費用面で非常に便利だが利用については各クラウドでそれぞれ利用方法が違いコマンドラインで利用するためにも際があるので使い勝手が良いとはいえませんでしたがこの <code>duck</code> を経由することで利用のハードルが下がります。</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-03-28T02:07:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2016年3月28日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/03/28/test/" itemprop="url">ATOMエディタからOctopressを利用する</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description">
<p>最近はVIMではなくATOMを利用していることもあって Atom エディタから簡単に利用することが出来るのかやってみました。</p>

<p>パッケージ　<code>markdown-writer</code> を利用します。</p>

<p>設定が <code>_mdwriter.cson</code> ファイルに出せるはずなのですが上手く行かなかったので<code>個人設定 config.cson</code>に直接設定を書きこみました。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class=""><span class="line">"markdown-writer":
</span><span class="line">  fileExtension: ".md"
</span><span class="line">  frontMatter: '''
</span><span class="line">    ---
</span><span class="line">    layout: &lt;layout&gt;
</span><span class="line">    title: "&lt;title&gt;"
</span><span class="line">    date: "&lt;date&gt;"
</span><span class="line">    published: false
</span><span class="line">    comments: false
</span><span class="line">    tags:
</span><span class="line">    categories:
</span><span class="line">    ---
</span><span class="line">    * Table of Contents
</span><span class="line">    {:toc}
</span><span class="line">
</span><span class="line">  '''
</span><span class="line">  siteEngine: "octopress"
</span><span class="line">  siteLocalDir: "/Users/hideaki/tokida.github.com/octopress/source/"
</span><span class="line">  sitePostsDir: "_posts/"
</span><span class="line">  siteUrl: "http://stepxstep.org"</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li><code>siteLocalDir</code> は必須です。最初入れていないでハマりました。その他のDirは siteLocalDirからの相対パスとなります。</li>
  <li>Octpress等のエンジンが選択できますが rake generate等をしてくれることはありません。 画像のフォーマットの指定が Octpress 用のタグを入れてくれるというものになります。</li>
  <li>ドラフト→パブリッシュはフォルダを移動させてくれる。</li>
  <li><code>rake generate</code> を別途実行する必要あがあります。</li>
</ul>

<p>rake generateを実行するために、パッケージ <code>Terminal-Plus</code> を導入します。（run-command2などでもよいかもしれません）
これを利用すると画面のしたにTerminal画面が表示されます。</p>

<p><img class="center" src="images/2016/03/screen20160328-22130.png" width="640" height="480" title="'screen'" /></p>

<p>ターミナルを開くとドキュメントと同じディレクトリがPATHに設定されるのでそのまま <code>rake preview</code> などと実行すれば利用できます。</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-03-27T09:01:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2016年3月27日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/03/27/bluemix-cli/" itemprop="url">Bluemix-cli</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description">
<p>Bluemix関連はもう色々出すぎていて何が何やらわからないのですが cf コマンドに代わる？bleumix Cliが登場していました。</p>

<ul>
  <li><a href="http://clis.ng.bluemix.net/ui/home.html">http://clis.ng.bluemix.net/ui/home.html</a></li>
</ul>

<p>さっそく導入してみたいと思います。私はMACユーザなのでMAC用のバイナリをダウンロードしてみたいと思います。</p>

<ul>
  <li>Cloud Foundry CLI version 6.11 or later is required for Bluemix CLI. If your system does not already have the correct version of cf CLI, the installer will install it for you. (cfコマンド 6.11以上を導入しておく必要があります。 cf –version で確認します。私は 6.13が導入されていました）</li>
  <li>　導入後パスが設定されていません。.bashrc に以下のPATHを追加しておきます。bash_autocompleteが有るのが今時なツールですね。bluemix と入力した後に tab をいれるとオプションが自動的に出てきて便利です。</li>
</ul>

<pre><code>### Added by the Bluemix CLI
export PATH=$PATH:/usr/local/bluemix/bin
source /usr/local/Bluemix/bx/bash_autocomplete
</code></pre>

<p>ヘルプを見てみるとこんな感じです。</p>

<pre><code>名前:
   ./bx - Bluemix と対話するためのコマンド・ライン・ツール

使用法:
   [environment variables] ./bx [global options] command [arguments...] [command options]

バージョン:
   0.3.1-5206a18-2016-03-02T03:30:07+00:00

コマンド:
   api		 ターゲットの API エンドポイントを設定または表示します
   login	 ユーザーをログインします
   logout	 ユーザーをログアウトします
   target	 ターゲット組織またはスペースを設定または表示します
   info		 Bluemix 情報を表示します
   list		 ターゲット・スペース内のすべての CF アプリケーション、サービス、コンテナー、コンテナー・グループ、および VM グループをリストします
   scale	 アプリまたはコンテナー・グループのインスタンス数を変更します
   curl		 Bluemix への未加工の HTTP 要求を実行します。content-type はデフォルトで「application/json'」に設定されています
   config	 デフォルト値を構成に書き込みます
   iam		 組織、スペース、およびユーザーを管理します
   catalog	 Bluemix カタログを管理します
   app		 Manage Cloud Foundry applications
   vm		 Manage virtual servers
   ic		 Manage IBM containers
   service	 Manage Bluemix services
   network	 Manage network settings including region, domain, route and security group
   security	 セキュリティー設定を管理します
   plugin	 プラグインおよびプラグイン・リポジトリーを管理します
   cf		 Bluemix のコンテキストを使用して Cloud Foundry CLI を実行します
   help

コマンドについて詳しくは、'./bx help [command]' と入力してください。

環境変数:
   BLUEMIX_COLOR=false                     出力に色を付けません
   BLUEMIX_TRACE=true                      API 要求診断を stdout に出力します
   BLUEMIX_TRACE=path/to/trace.log         API 要求診断をログ・ファイルに付加します

グローバル・オプション:
   --version, -v                      バージョンを出力します
   --help, -h                         ヘルプを表示します
</code></pre>

<p>色々なサブコマンドが利用できてこれは便利になります。</p>

<pre><code>$ bx iam
名前:
   bx iam - 組織、スペース、およびユーザーを管理します
使用法:
   bx iam command [arguments...] [command options]

コマンド:
   orgs			 すべての組織をリストします
   org			 指定された組織の情報を表示します
   org-create		 新しい組織を作成します (管理者のみ)
   org-replicate	 組織を別の地域に複製します (管理者のみ)
   org-rename		 組織を名前変更します (組織管理者が必要)
   org-delete		 組織を削除します (管理者のみ)
   spaces		 現行組織内のすべてのスペースをリストします
   space		 指定されたスペースの情報を表示します
   space-create		 新しいスペースを作成します (組織管理者が必要)
   space-rename		 現行組織内のスペースを名前変更します (組織管理者が必要)
   space-delete		 現行組織内のスペースを削除します (組織管理者が必要)
   user-create		 新しいユーザーを作成します (管理者のみ)
   user-delete		 ユーザーを削除します (管理者のみ)
   org-users		 指定された組織内のユーザーを役割別に表示します
   org-role-set		 ユーザーに組織の役割を割り当てます (組織管理者が必要)
   org-role-unset	 ユーザーから組織の役割を削除します (組織管理者が必要)
   space-users		 指定されたスペース内のユーザーを役割別に表示します
   space-role-set	 ユーザーにスペースの役割を割り当てます (スペース管理者が必要)
   space-role-unset	 ユーザーからスペースの役割を削除します (スペース管理者が必要)
   help

コマンドについて詳しくは、'bx iam help [command]' と入力してください。
</code></pre>

<p>これまで cf コマンドでアプリケーションを管理していましたがこのbluemixコマンドで Bluemixとして実施することが大分楽になりそうです。</p>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-11-04T02:29:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2014年11月4日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2014/11/04/vyatta2vyos/" itemprop="url">Vyatta を VyOS にアップデートして Vxlan を利用する</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><ul id="markdown-toc">
  <li><a href="#add-system-images">add system images</a></li>
  <li><a href="#vxlan-on-vyos-">vxlan on VyOS を試す</a></li>
</ul>

<p>VyOSを利用してみたかったので一旦Vyattaを導入してアップデート <sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> を試みる。
利用している環境は、SoftLayer上の仮想サーバ(Vyatta6.5導入済み）を利用しています。</p>

<h1 id="add-system-images">add system images</h1>

<p>VyOSへのアップデートの方法は、公式サイトの以下のリンクに記載されています。</p>

<ul>
  <li><a href="http://wiki.vyos-users.jp/Vyatta%E3%81%8B%E3%82%89%E3%81%AE%E7%A7%BB%E8%A1%8C">vyos-users.jp</a></li>
</ul>

<p>今回はVersion1.1を試してみたいと思います。</p>

<pre><code>vyatta@vyatta-dal01:~$ show system image
The system currently has the following image(s) installed:

   1: Old-non-image-installation (default boot)

vyatta@vyatta-dal01:~$ add system image http://ftp.tsukuba.wide.ad.jp/software/vyos/iso/release/1.1.0/vyos-1.1.0-amd64.iso
Trying to fetch ISO file from http://ftp.tsukuba.wide.ad.jp/software/vyos/iso/release/1.1.0/vyos-1.1.0-amd64.iso
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  231M  100  231M    0     0  5687k      0  0:00:41  0:00:41 --:--:-- 8782k
ISO download succeeded.
Checking for digital signature file...
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   836  100   836    0     0    540      0  0:00:01  0:00:01 --:--:--  2229
Found it.  Checking digital signature...
gpg: directory `/root/.gnupg' created
gpg: new configuration file `/root/.gnupg/gpg.conf' created
gpg: WARNING: options in `/root/.gnupg/gpg.conf' are not yet active during this run
gpg: keyring `/root/.gnupg/pubring.gpg' created
gpg: Signature made Thu Oct  9 17:42:59 2014 CDT using RSA key ID A442E6E9
gpg: /root/.gnupg/trustdb.gpg: trustdb created
gpg: Good signature from "SO3 Group Maintainers &lt;maintainers@so3group.net&gt;"
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: DD5B B405 35E7 F6E3 4278  1ABF B744 E25A A442 E6E9
Digital signature is valid.
Checking MD5 checksums of files on the ISO image...OK.
Done!
What would you like to name this image? [1.1.0]:
OK.  This image will be named: 1.1.0
Installing "1.1.0" image.
Copying new release files...
Would you like to save the current configuration
directory and config file? (Yes/No) [Yes]:
Copying current configuration...
Would you like to save the SSH host keys from your
current configuration? (Yes/No) [Yes]:
Copying SSH keys...
Setting up grub configuration...
Done.
vyatta@vyatta-dal01:~$ show system image
The system currently has the following image(s) installed:

   1: 1.1.0 (default boot)
   2: Old-non-image-installation
</code></pre>

<p>この状態で<code>reboot</code>をすると新しいイメージで起動をしてきます。</p>

<pre><code>Welcome to VyOS
vyatta@67.228.185.132's password:
Linux vyatta 3.13.11-1-amd64-vyos #1 SMP Wed Sep 3 20:04:22 UTC 2014 x86_64
Welcome to VyOS.
This system is open-source software. The exact distribution terms for
each module comprising the full system are described in the individual
files in /usr/share/doc/*/copyright.
</code></pre>

<h1 id="vxlan-on-vyos-">vxlan on VyOS を試す</h1>

<p>少し前に vxlan on Softlayer ということで同一データセンター内ではマルチキャストが通信できるのでvlanが使えたという事を書きました。VyOSの最新版ではvxlanがサポートされているとのことなので試します。</p>

<pre><code>vyatta@vyatta-dal01# configure
[edit]
vyatta@vyatta-dal01# set interfaces  vxlan vxlan0
[edit]
vyatta@vyatta-dal01# set interfaces vxlan vxlan0 group 239.1.1.1
[edit]
vyatta@vyatta-dal01# set interfaces vxlan vxlan0 vni 42
[edit]
vyatta@vyatta-dal01# ip a

vyatta@vyatta-dal01# set interfaces vxlan vxlan0 address '192.168.42.254/24'
[edit]
vyatta@vyatta-dal01# commit
[edit]
vyatta@vyatta-dal01# save
Saving configuration to '/config/config.boot'...
Done
[edit]
vyatta@vyatta-dal01#   show interfaces vxlan vxlan0
 address 192.168.42.254/24
 group 239.1.1.1
 vni 42
[edit]
vyatta@vyatta-dal01# ip a
4: vxlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default
    link/ether b6:37:f4:fa:30:d0 brd ff:ff:ff:ff:ff:ff
    inet 192.168.42.254/24 brd 192.168.42.255 scope global vxlan0
       valid_lft forever preferred_lft forever
    inet6 fe80::b437:f4ff:fefa:30d0/64 scope link
[edit]	
</code></pre>

<p>他のサーバの設定は <a href="http://stepxstep.org/blog/2014/11/01/vxlan-on-softlayer/">Vxlan on Softlayer - なんでもやってみるのが良いと思う</a> として行います。現状でこの構成に今回の VyOS が追加されている形になります。</p>

<pre><code>vyatta@vyatta-dal01:~$ ping 192.168.42.2
PING 192.168.42.2 (192.168.42.2) 56(84) bytes of data.
64 bytes from 192.168.42.2: icmp_req=1 ttl=64 time=0.635 ms
64 bytes from 192.168.42.2: icmp_req=2 ttl=64 time=0.402 ms
^C
--- 192.168.42.2 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 999ms
rtt min/avg/max/mdev = 0.402/0.518/0.635/0.118 ms
vyatta@vyatta-dal01:~$ ping 192.168.42.3
PING 192.168.42.3 (192.168.42.3) 56(84) bytes of data.
64 bytes from 192.168.42.3: icmp_req=1 ttl=64 time=1.52 ms
64 bytes from 192.168.42.3: icmp_req=2 ttl=64 time=0.303 ms
^C
--- 192.168.42.3 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.303/0.913/1.523/0.610 ms
</code></pre>

<p>ということで問題なく疎通が出来ています。</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>SoftLayerでは仮想サーバのOSを独自には導入できないので初期にVyOSが入れられない。 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-11-04T01:46:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2014年11月4日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2014/11/04/sl-docker/" itemprop="url">SoftlayerのslコマンドのDocker化</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>SoftLayerのSLコマンドをDocker化しました。
単にDockerhubのAutomated Buildで遊んでみたかっただけなのですが・・</p>

<p>特に理由ないのですが各Linuxサーバに Python + SoftLayer-Cli 入れるのと Docker 入れるのとどっちがいいかなと思った場合にアプリケーションに影響なく利用できそうなのはDockerかなと。</p>

<p>作ってみてローカルのMacbookで利用しているのですが便利です。
これまでVagrant経由でVM起動してそのなかでゴニョゴニョしていました。今回のDockerにしてもboot2dockerで結局のところ似たような感じなのですが<code>config setup</code>で複数のSoftLayer環境を用意する際や、VersionUpをした際に簡単に分離して管理できるのは楽でした。 (まあ.dotfile切り替えるだけなら別の手段もあるかと思いますが)</p>

<h1 id="section">利用方法</h1>

<h2 id="section-1">想定</h2>

<p>このツールは、IBM社のクラウドサービス「SoftLayer」のCLIコマンドである sl コマンドを利用することが出来ます。
本番機などであまりslコマンド及び前提であるpythonを導入したくない場合。Dockerを利用うすることでOS側に影響なくコマンドを利用することが出来ます。 このDockerのImageは470MByte前後のサイズに成ります。</p>

<h2 id="section-2">設定</h2>

<p>以下のコマンドで設定ファイルをコンテナ内部に作ります。</p>

<p><code>$ docker run  -ti tokida/softlayer-cli config setup</code></p>

<p>通常のslコマンド同様にUsernameとAPIキーを設定して下さい。
次に、コンテナを自分用としてローカルにcommitしておきます。</p>

<p><code>$ docker restart 993ae5495011</code></p>

<p>一度コンテナをRestartします。</p>

<p><code>$ docker commit -m "my account" 993ae5495011 tokida/softlayer-cli:my</code></p>

<p>(数字はコンテナIDで <code>docker ps -a</code>で参照すること)
ここではTagに<code>my</code>をつけています。</p>

<h2 id="section-3">利用方法</h2>

<p><code>$ docker run  -ti tokida/softlayer-cli:my  vs list</code></p>

<p>という形で利用することが出来ます。長いのでシェルでエリアス等をしておくと良いかと思います。</p>

<p><code>$ alias sl="docker run  -ti tokida/softlayer-cli:my"</code></p>

<p>こうしておくと普段通り <code>sl</code> コマンドが利用できます。</p>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-11-01T00:44:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2014年11月1日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2014/11/01/vxlan-on-softlayer/" itemprop="url">Vxlan on Softlayer</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><ul id="markdown-toc">
  <li><a href="#section">これは何？</a></li>
  <li><a href="#section-1">環境</a></li>
  <li><a href="#subnet">同一Subnet内</a></li>
  <li><a href="#vlan">異なるVLAN間</a></li>
</ul>

<h1 id="section">これは何？</h1>

<p>SoftLayerのネットワークはマルチキャストが使えるのでvxlanが動くのかを確認。</p>

<ol>
  <li>同一のSubnet内で利用可能か</li>
  <li>同一のvlan間で利用可能か（これは今回オーダー出来ず）</li>
  <li>異なるVLAN間（VLAN Spaning = on )で利用可能か</li>
</ol>

<p>というところを確認する。</p>

<h1 id="section-1">環境</h1>

<p>今回用意したのはダラスデータセンター内に仮想サーバを2つ起動している状態。プライベートIPで割り当てられているのは同一のSubnet上で登録されている。OSはUbuntu14.04を利用。</p>

<p>仮想サーバは以下のコマンドで作成する。</p>

<pre><code>sl vs create --datacenter=dal01 --cpu=1 --memory=1024 --os=UBUNTU_14_64 --domain=sl.com --hostname=test01 --hourly --san --disk=25,10 --key=mainkey --postinstall=https://gist.githubusercontent.com/tokida/5b58831c0d94ce7b25f2/raw/bootstrap4Ubuntu.sh
</code></pre>

<p>作成した結果は以下の感じになりました。同じSubnetになっていますね。違うSubnetに付け直したかったら動するのがいいのかな？:</p>

<pre><code>:.........:............:...............:.......:........:................:.............:....................:...........:
:    id   : datacenter :      host     : cores : memory :   primary_ip   :  backend_ip : active_transaction :   owner   :
:.........:............:...............:.......:........:................:.............:....................:...........:
: 6743772 :   dal01    : test01.sl.com :   1   :   1G   : 67.228.***.*** : 10.17.93.45 :         -          : *****     :
: 6816622 :   dal01    : test02.sl.com :   1   :   1G   : 67.228.***.*** : 10.17.93.46 :         -          : *****     :
:.........:............:...............:.......:........:................:.............:....................:...........:
</code></pre>

<h1 id="subnet">同一Subnet内</h1>

<p>以下のコマンドによりvxlanを設定する。今回は内部eth0に対して作成する</p>

<pre><code>$ ip link add vxlan0 type vxlan id 42 group 239.1.1.1 dev eth0
$ ip link set up vxlan0
$ ip a add 192.168.42.3/24 dev vxlan0
$ root@test02:~# ip -d link show vxlan0
4: vxlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default
    link/ether 2e:eb:95:ed:97:9d brd ff:ff:ff:ff:ff:ff promiscuity 0
    vxlan id 42 group 239.1.1.1 dev eth0 port 32768 61000 ageing 300
</code></pre>

<p>test01は、<code>192.168.42.2</code>を付与、test02は、<code>192.168.43.3</code>を付与します。</p>

<p>Pingを実行すると</p>

<pre><code>root@test02:~# ping 192.168.42.2
PING 192.168.42.2 (192.168.42.2) 56(84) bytes of data.
64 bytes from 192.168.42.2: icmp_seq=1 ttl=64 time=0.957 ms
64 bytes from 192.168.42.2: icmp_seq=2 ttl=64 time=0.377 ms
</code></pre>

<p>通信ができていることがわかります。マルチキャスト動いているようですね。</p>

<h1 id="vlan">異なるVLAN間</h1>

<p>3台目のサーバをサンノゼに作成します。この場合Subetが違いまたVLANが違う環境となります。VLANスパニングを有効にしているのでこのダラス⇔サンノゼ通信ができるようになっています。</p>

<pre><code>:.........:............:...............:.......:........:................:.............:....................:...........:
:    id   : datacenter :      host     : cores : memory :   primary_ip   :  backend_ip : active_transaction :   owner   :
:.........:............:...............:.......:........:................:.............:....................:...........:
: 6743772 :   dal01    : test01.sl.com :   1   :   1G   : 67.228.***.*** : 10.17.93.45 :         -          : ********* :
: 6816622 :   dal01    : test02.sl.com :   1   :   1G   : 67.228.***.*** : 10.17.93.46 :         -          : ********* :
: 6816998 :   sjc01    : test03.sl.com :   1   :   1G   : 158.85.***.*** : 10.89.0.170 :                    : ********* :
:.........:............:...............:.......:........:................:.............:....................:...........:
</code></pre>

<p>先ほど同様に設定を行い <code>192.168.42.4/24</code>としました。</p>

<pre><code>root@test01:~# ping 192.168.42.4
PING 192.168.42.4 (192.168.42.4) 56(84) bytes of data.
From 192.168.42.2 icmp_seq=1 Destination Host Unreachable
From 192.168.42.2 icmp_seq=2 Destination Host Unreachable
From 192.168.42.2 icmp_seq=3 Destination Host Unreachable
From 192.168.42.2 icmp_seq=4 Destination Host Unreachable
From 192.168.42.2 icmp_seq=5 Destination Host Unreachable
</code></pre>

<p>あわよくば動けば面白いなと思ったけど残念ながらこちらは通信出来ない模様ですね。さすがにDataCenterをまたいでマルチキャストが許可されていないのでしょうか。</p>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-09-17T20:40:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2014年9月17日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2014/09/17/consistentstorage/" itemprop="url">SoftLayerに性能保証型iSCSI/NASが登場したので試してみた</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description">
<pre><code>2014/11/04 追記: [帯域]保証型と書いていましたが、帯域は保証されていないとご指摘を（確かにその通り）受けたので[性能]保証型にしました。さらに言えば性能も保証されていないのですが。
</code></pre>

<p>SoftLayerでの新機能で「性能保証型ブロックデバイス」が登場しました。
1月ほど前からAPIには登場していたのですがようやく正式にリリースされた感じですね。</p>

<h1 id="section">これは何？</h1>

<p>SoftLayerの性能保証型のブロックストレージを購入して簡単にfioでパフォーマンス測定してみましょう。
対象としては普段から利用していることもあり仮想サーバ上からUbuntu14.04を利用したいと思います。</p>

<ul>
  <li>容量 20Gから12TByteまで</li>
  <li>性能保証 100IOPS から 6000IOPSまで</li>
  <li>iSCSI(Block Storage)とNAS(File Storage)の2つのインターフェースで提供</li>
</ul>

<h1 id="section-1">オーダーから設定まで</h1>

<h2 id="section-2">オーダ方法</h2>

<p>オーダ時のオプションで利用OSを選択するようになっていますね。
管理ポータルから、<code>Storage</code>→<code>Block Storage</code>→<code>Order Consistent Performance</code>を選択しましょう。</p>

<p><img src="/images/2014-09-17-iscsi.png" alt="iscsi" /></p>

<p>ここでの費用は、「ディスクサイズ」＋「IOPS」となるようです。この画像の場合、<code>20 GB 100 to 1000 IOPS</code>というは20GのiSCSIディスクはIOPS
として100から1000までが指定可能ということになります。一番安い、20G 100IOPSをオーダしてみたいと思います。</p>

<h2 id="section-3">設定方法</h2>

<p>購入したデバイス（ここでは<code>SL01SL29*****-1 (20 GB)</code>のような名称)の詳細を確認します。
iSCSIデバイスらしく<code>Authorized Hosts</code>という項目があるので利用したいサーバを指定します、すると「Username」「Password」「Host IQN」「Device Type」が該当のホスト向けに表示されます。</p>

<p>画面を見る限り以前までのSnapshotなどの機能はなさそうです（残念！）</p>

<p>今回のiSCSIはマルチパスで構成されているようなので<code>multipath-tools</code>を導入して利用します。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">apt-get install multipath-tools
</span><span class="line">apt-get install open-iscsi</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>iSCSIの設定を行います。<code>/etc/iscsi/initiatorname.iscsi</code>のファイルにIQNを設定します。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">InitiatorName= "value-from-the-SL-Portal"</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>次に<code>/etc/iscsi/iscsid.conf</code>を以下の内容を記載します。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">node.session.auth.authmethod = CHAP
</span><span class="line">node.session.auth.username = "Username-value-from-SL-Portal"
</span><span class="line">node.session.auth.password = "Password-value-from-SL-Portal"
</span><span class="line">discovery.sendtargets.auth.authmethod = CHAP
</span><span class="line">discovery.sendtargets.auth.username = "Username-value-from-SL-Portal"
</span><span class="line">discovery.sendtargets.auth.password = "Password-value-from-SL-Portal"</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>設定が終わったら <code>/etc/init.d/open-iscsi restart</code>で再起動を行います。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">root@ansibletower:~# iscsiadm -m discovery -t sendtargets -p 10.2.174.111
</span><span class="line">10.2.174.111:3260,1036 iqn.1992-08.com.netapp:hkg0201
</span><span class="line">10.2.174.102:3260,1035 iqn.1992-08.com.netapp:hkg0201</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>iSCSIを探してみると2つのIPで見つけることが出来ました。先ほど書いたようにMultipathでの接続が前提のようですね。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class=""><span class="line">root@ansibletower:~#  iscsiadm -m node --login
</span><span class="line">Logging in to [iface: default, target: iqn.1992-08.com.netapp:hkg0201, portal: 10.2.174.111,3260] (multiple)
</span><span class="line">Logging in to [iface: default, target: iqn.1992-08.com.netapp:hkg0201, portal: 10.2.174.102,3260] (multiple)
</span><span class="line">Login to [iface: default, target: iqn.1992-08.com.netapp:hkg0201, portal: 10.2.174.111,3260] successful.
</span><span class="line">Login to [iface: default, target: iqn.1992-08.com.netapp:hkg0201, portal: 10.2.174.102,3260] successful.
</span><span class="line">root@ansibletower:~#
</span><span class="line">root@ansibletower:~#
</span><span class="line">root@ansibletower:~# iscsiadm -m session -o show
</span><span class="line">tcp: [1] 10.2.174.111:3260,1036 iqn.1992-08.com.netapp:hkg0201
</span><span class="line">tcp: [2] 10.2.174.102:3260,1035 iqn.1992-08.com.netapp:hkg0201</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>この作業により<code>/dev/sda</code>と<code>/dev/sdb</code>としてiSCSIが認識されます。また先ほど導入したmultipathを確認すると</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">root@ansibletower:~# multipath -l
</span><span class="line">3600a0980383030525324464331596470 dm-0 NETAPP,LUN C-Mode
</span><span class="line">size=20G features='1 queue_if_no_path' hwhandler='0' wp=rw
</span><span class="line">|-+- policy='round-robin 0' prio=-1 status=active
</span><span class="line">| `- 0:0:0:186 sdb  8:16   active undef running
</span><span class="line">`-+- policy='round-robin 0' prio=-1 status=enabled
</span><span class="line">  `- 1:0:0:186 sda  8:0    active undef running</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>このようにFailover型でデバイスが登録されているのがわかります。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">root@ansibletower:~#  fdisk -l | grep /dev/mapper
</span><span class="line">ディスク /dev/sdb は正常なパーティションテーブルを含んでいません
</span><span class="line">ディスク /dev/sda は正常なパーティションテーブルを含んでいません
</span><span class="line">ディスク /dev/mapper/3600a0980383030525324464331596470 は正常なパーティションテーブルを含んでいません
</span><span class="line">Disk /dev/mapper/3600a0980383030525324464331596470: 21.5 GB, 21474836480 bytes</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>device mapper経由では上記のデバイスとして認識されています。これ以降はこのデバイスに対してfdiskが有効なのでパーティションを作成して利用することに成ります。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class=""><span class="line">root@ansibletower:~# lsblk
</span><span class="line">NAME                                       MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
</span><span class="line">sda                                          8:0    0    20G  0 disk
</span><span class="line">└─3600a0980383030525324464331596470 (dm-0) 252:0    0    20G  0 mpath
</span><span class="line">sdb                                          8:16   0    20G  0 disk
</span><span class="line">└─3600a0980383030525324464331596470 (dm-0) 252:0    0    20G  0 mpath
</span><span class="line">xvda                                       202:0    0   100G  0 disk
</span><span class="line">├─xvda1                                    202:1    0   243M  0 part  /boot
</span><span class="line">└─xvda2                                    202:2    0  99.8G  0 part  /
</span><span class="line">xvdb                                       202:16   0     2G  0 disk
</span><span class="line">└─xvdb1                                    202:17   0     2G  0 part  [SWAP]</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>fdiskでパーティションを作成し、カーネルにデバイスの変更を通知してxfsformatを行います。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class=""><span class="line">root@ansibletower:~# fdisk /dev/mapper/3600a0980383030525324464331596470
</span><span class="line">
</span><span class="line">root@ansibletower:~# partprobe
</span><span class="line">Error: /dev/sda: ディスクラベルが認識できません。
</span><span class="line">Error: /dev/sdb: ディスクラベルが認識できません。
</span><span class="line">Error: /dev/mapper/3600a0980383030525324464331596470p1: ディスクラベルが認識できません。
</span><span class="line">root@ansibletower:~# mkfs.xfs /dev/mapper/3600a0980383030525324464331596470p1
</span><span class="line">meta-data=/dev/mapper/3600a0980383030525324464331596470p1 isize=256    agcount=16, agsize=327663 blks
</span><span class="line">         =                       sectsz=4096  attr=2, projid32bit=0
</span><span class="line">data     =                       bsize=4096   blocks=5242608, imaxpct=25
</span><span class="line">         =                       sunit=1      swidth=16 blks
</span><span class="line">naming   =version 2              bsize=4096   ascii-ci=0
</span><span class="line">log      =internal log           bsize=4096   blocks=2560, version=2
</span><span class="line">         =                       sectsz=4096  sunit=1 blks, lazy-count=1
</span><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>実際にmountしてみる。恒久的に利用する場合には別途定義を行って下さい。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">root@ansibletower:~# mkdir /mnt/data1
</span><span class="line">root@ansibletower:~# mount /dev/mapper/3600a0980383030525324464331596470p1 /mnt/data1</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="iops">IOPS試験の実施</h1>

<p>簡単にするためにgistにスクリプトを置いています</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">$ apt-get install fio
</span><span class="line">$ apt-get install curl
</span><span class="line">$ export DISK=/mnt/data1 ; curl -s https://gist.githubusercontent.com/tokida/090eaa6475e58b4368c0/raw/fio_test.sh | sh</span></code></pre></td></tr></table></div></figure></notextile></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Benchmark</th>
      <th style="text-align: right">Bandwiddh</th>
      <th style="text-align: right">IOPS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">4k, sequential read</td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">147</td>
    </tr>
    <tr>
      <td style="text-align: left">4k, sequential write</td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">165</td>
    </tr>
    <tr>
      <td style="text-align: left">4k, randam read</td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">107</td>
    </tr>
    <tr>
      <td style="text-align: left">4k, randam write</td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">103</td>
    </tr>
    <tr>
      <td style="text-align: left">32m, sequential read</td>
      <td style="text-align: right">51.871MB/s</td>
      <td style="text-align: right"> </td>
    </tr>
    <tr>
      <td style="text-align: left">32m, sequential write</td>
      <td style="text-align: right">12.221MB/s</td>
      <td style="text-align: right"> </td>
    </tr>
  </tbody>
</table>

<p>参考までに同じ試験項目でローカルディスク(100G SAN)を実施した場合</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Benchmark</th>
      <th style="text-align: right">Bandwiddh</th>
      <th style="text-align: right">IOPS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">4k, sequential read</td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">27362</td>
    </tr>
    <tr>
      <td style="text-align: left">4k, sequential write</td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">26305</td>
    </tr>
    <tr>
      <td style="text-align: left">4k, randam read</td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">14188</td>
    </tr>
    <tr>
      <td style="text-align: left">4k, randam write</td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">22233</td>
    </tr>
    <tr>
      <td style="text-align: left">32m, sequential read</td>
      <td style="text-align: right">114.070MB/s</td>
      <td style="text-align: right"> </td>
    </tr>
    <tr>
      <td style="text-align: left">32m, sequential write</td>
      <td style="text-align: right">113.188MB/s</td>
      <td style="text-align: right"> </td>
    </tr>
  </tbody>
</table>

<h1 id="section-4">まとめ</h1>

<p>今回オーダしたのは100IOPSのBlock Storageになりますが、確かに100前後で制御されているように見えます。帯域はこれがMaxなのか分かりませんがこのあたりも今後確認していきたいところですね。</p>

<p>良かった点は、iSCSIがMultipathになった点でしょうか、とはいえ手軽さはNFS(FileStorage)での利用ですかね。また帯域が保証されているので6000IOPSを複数束ねてRaid0構成も出来るかもしれませんね。ただし結構費用が高いのが辛いかもしれないですが。12TByte(6000IOPS)の場合 $1,200+$720になるので $0.16/GByte となりますね。</p>

<p><img src="/images/2014-09-17-iscsi02.png" alt="os" /></p>

<p>このパラメータが何を意味しているのか調べていないのですが<code>AIX</code>とかありますね！</p>

<p>悪かった点は、以前のiSCSIが抽象化された利便性の高いデバイスだったのですが今回はかなり素のiSCSIデバイスとしての利用になります。とくにSnapshotが使えないのは残念ですね。今回の場合にはこのiSCSIデバイスのバックアップをなにか考えなければいけません。12Tとか考えるとかなり面倒な感じですね。</p>

<h1 id="section-5">参考</h1>

<ul>
  <li><a href="http://knowledgelayer.softlayer.com/procedure/accessing-block-storage-consistent-performance-linux">Accessing Block Storage Consistent Performance on Linux</a></li>
  <li><a href="https://gist.githubusercontent.com/tokida/090eaa6475e58b4368c0/raw/738cec3a3dfa7816d65882c5d45d513e4a8cc160/fio_test.sh">FIO試験スクリプト</a></li>
</ul>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-08-25T11:28:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2014年8月25日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2014/08/25/xml-rpc-ddos/" itemprop="url">XMLRPCに大量にアクセスされている場合の回避策</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>さてCPU使用率が100%になったりApacheのデーモンが大量に発生したりした場合どんな原因が考えられますか？
最近担当しているサーバからMemoryがいっぱいだよ、CPUがいっぱいだよとNew Relic経由でメールが届いたと思ったら触れなくなっていました。</p>

<p>調べてみるとhttpdが大量に起動してメモリがなくなりフォークしたプロセスがKillされている状態でした。標準の設定でhttpd.confを書いているのでそもそも大量にコネクションがあった場合（今回のようなケース）はメモリが足りないなという状態だったので計算をしみたところ一つあたり57MByteもメモリを使っているという富豪な設定になっていました。ApacheでLoadModuleされすぎです。（CentOSの標準パッケージの問題だと思いますが）</p>

<p>さて、そのようなことは横においておくとして今回の原因は xml-rpc.php に対して不特定の大量のアクセスが発生指定していることから起こっています。</p>

<p>以下の例は暫定で<code>xmlrpc.php</code>を削除しています。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class=""><span class="line">88.150.160.81 - - [23/Aug/2014:11:24:30 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">172.245.37.220 - - [23/Aug/2014:11:24:31 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">96.8.126.60 - - [23/Aug/2014:11:24:31 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">109.104.118.82 - - [23/Aug/2014:11:24:31 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">88.150.160.82 - - [23/Aug/2014:11:24:32 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">172.245.221.237 - - [23/Aug/2014:11:24:32 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">185.17.151.106 - - [23/Aug/2014:11:24:32 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">217.78.5.180 - - [23/Aug/2014:11:24:32 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">192.3.43.160 - - [23/Aug/2014:11:24:32 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">96.8.123.95 - - [23/Aug/2014:11:24:34 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">217.78.5.165 - - [23/Aug/2014:11:24:37 -0500] "POST /xmlrpc.php HTTP/1.1" 404 286 "-" "-"
</span><span class="line">^C</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section">対策</h3>

<p>幾つかの対策が考えられます。</p>

<ul>
  <li>XMLRPCの機能を無効化する（Wordpress3.5以降はディフォルトで有効になっているためソースを変更する必要がありそうです／VersionUp等の際にまた忘れる可能性があるので今回は選択しません）。</li>
  <li>プラグインで無効化（プラグインで無効化してもPHPが動くためCPUリソースは食べそうです）／これはこれで導入しておきましょう。</li>
  <li>接続可能なIPアドレスを制限する（今回はこれ）</li>
</ul>

<p>今回はこの3番目のアドレスで制限をしてみたいと思います。このサーバは、Public側とPrivate側に2つのネットワークインターフェースを持っているサーバとなっています。また設定についてはApacheだったので以下のようなディレクティブを追加することで対応が出来ます。</p>

<h3 id="section-1">設定内容</h3>

<ul>
  <li><code>httpd.conf</code>に以下を追記する。xmlrpc.php　は 10.0.0.0　からのアクセスのみ許可にする。</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;Files xmlrpc.php&gt;
</span><span class="line">    order deny,allow
</span><span class="line">    deny from all
</span><span class="line">    allow from 10.0.0.0/255.0.0.0
</span><span class="line">&lt;/Files&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>これでPrivateNetworki(10.0.0.0)側のみになりそれ以外は403でエラーになります。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class=""><span class="line">172.245.37.225 - - [23/Aug/2014:11:35:55 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">109.104.118.117 - - [23/Aug/2014:11:35:56 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">109.104.118.82 - - [23/Aug/2014:11:35:56 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">198.23.154.30 - - [23/Aug/2014:11:35:57 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">109.104.118.117 - - [23/Aug/2014:11:35:57 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">217.78.5.166 - - [23/Aug/2014:11:35:58 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">109.104.118.131 - - [23/Aug/2014:11:35:58 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">96.8.125.21 - - [23/Aug/2014:11:35:59 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">217.78.5.165 - - [23/Aug/2014:11:35:59 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">109.104.118.77 - - [23/Aug/2014:11:36:00 -0500] "POST /xmlrpc.php HTTP/1.1" 403 290 "-" "-"
</span><span class="line">^C</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-2">まとめ</h3>

<p>今回リソースはNewRelicで見ていましたがログまでは保管していなかったため問題が発生している際に状況を調べるのが面倒でした。というかCPU100%の状態を解消しないと見ることが出来ませんでした。キチンとFluentd等で別のログサーバにデータを転送しておきたいと思います。</p>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-08-22T01:30:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2014年8月22日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2014/08/22/first_serf/" itemprop="url">Serfを試してみる</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><ul id="markdown-toc">
  <li><a href="#section">はじめに</a></li>
  <li><a href="#section-1">導入</a></li>
  <li><a href="#section-2">起動</a>    <ul>
      <li><a href="#mdns">mDNSを利用したクラスタへのログイン</a></li>
    </ul>
  </li>
  <li><a href="#section-3">使い方</a>    <ul>
      <li><a href="#eventhandler">最初に各サーバに最初のEventHandlerのシェルを配置する</a></li>
    </ul>
  </li>
  <li><a href="#section-4">まとめ</a></li>
  <li><a href="#section-5">参考</a></li>
</ul>

<h1 id="section">はじめに</h1>

<p>Software Design 2014/09号に「Serf・Consul入門」が載っていたのでそれを参考に少し動かしてみました。また記事を書かれている @zenbutu さんのQiita上でのまとめを参考にしています。</p>

<ul>
  <li><a href="http://qiita.com/zembutsu/items/aaffab81f9d5b60d7ecc">SerfとConsulの記事まとめ - Qiita</a></li>
  <li><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00M7AWOJQ/ref=nosim?tag=maftracking33806-22&amp;linkCode=ure&amp;creative=6339">Software Design (ソフトウェア デザイン) 2014年 09月号</a></li>
</ul>

<h1 id="section-1">導入</h1>

<p><a href="http://www.serfdom.io/downloads.html">http://www.serfdom.io/downloads.html</a></p>

<p>上記から各サーバにあったものを落とす。
ここではUbuntu14.04を2台で試すので</p>

<p><a href="https://dl.bintray.com/mitchellh/serf/0.6.3_linux_amd64.zip">https://dl.bintray.com/mitchellh/serf/0.6.3_linux_amd64.zip</a></p>

<p>を利用する</p>

<pre><code>$ apt-get install unzip
$ wget https://dl.bintray.com/mitchellh/serf/0.6.3_linux_amd64.zip
$ unzip 0.6.3_linux_amd64.zip
$ cp ./serf /usr/bin/serf
</code></pre>

<p>バージョンの確認</p>

<pre><code>$ serf version
Serf v0.6.3
Agent Protocol: 4 (Understands back to: 2)
</code></pre>

<h1 id="section-2">起動</h1>

<p>バックグラウンドでの起動</p>

<pre><code>root@serf1:~# serf agent &amp;
[1] 10094
root@serf1:~# ==&gt; Starting Serf agent...
==&gt; Starting Serf agent RPC...
==&gt; Serf agent running!
         Node name: 'serf1'
         Bind addr: '0.0.0.0:7946'
          RPC addr: '127.0.0.1:7373'
         Encrypted: false
          Snapshot: false
           Profile: lan

==&gt; Log data will now stream in as it occurs:

    2014/08/21 18:31:15 [INFO] agent: Serf agent starting
    2014/08/21 18:31:15 [INFO] serf: EventMemberJoin: serf1 10.114.16.197
    2014/08/21 18:31:16 [INFO] agent: Received event: member-join
</code></pre>

<p>エージェントの確認／クラスタの状態の確認</p>

<pre><code>root@serf1:~# serf members
    2014/08/21 18:32:13 [INFO] agent.ipc: Accepted client: 127.0.0.1:44401
serf1  10.114.16.197:7946  alive
</code></pre>

<p>2台目のサーバで、上記のSerf導入後以下を実施</p>

<pre><code>root@serf2$ serf agent &amp;
root@serf1$ serf join 10.114.16.197 
    2014/08/21 18:35:05 [INFO] agent.ipc: Accepted client: 127.0.0.1:48145
    2014/08/21 18:35:05 [INFO] agent: joining: [10.114.16.197] replay: false
    2014/08/21 18:35:05 [INFO] serf: EventMemberJoin: serf1 10.114.16.197
    2014/08/21 18:35:05 [INFO] agent: joined: 1 nodes
Successfully joined cluster by contacting 1 nodes.
root@serf2:~#     2014/08/21 18:35:06 [INFO] agent: Received event: member-join
</code></pre>

<p>1台目でMemberの確認</p>

<pre><code>root@serf1:~# serf members
    2014/08/21 18:36:12 [INFO] agent.ipc: Accepted client: 127.0.0.1:44421
serf1  10.114.16.197:7946  alive
serf2  10.114.16.196:7946  alive
</code></pre>

<p>止める</p>

<pre><code>root@serf1:~# serf leave
    2014/08/21 18:44:31 [INFO] agent.ipc: Accepted client: 127.0.0.1:44457
    2014/08/21 18:44:31 [INFO] agent.ipc: Graceful leave triggered
    2014/08/21 18:44:31 [INFO] agent: requesting graceful leave from Serf
    2014/08/21 18:44:31 [INFO] serf: EventMemberLeave: serf1 10.114.16.197
    2014/08/21 18:44:31 [INFO] agent: requesting serf shutdown
    2014/08/21 18:44:31 [INFO] agent: shutdown complete
    2014/08/21 18:44:31 [WARN] agent: Serf shutdown detected, quitting
Error leaving: client closed
[1]+  終了                  serf agent
</code></pre>

<h2 id="mdns">mDNSを利用したクラスタへのログイン</h2>

<p>serfサーバをJoinするのにIPアドレスなどでしてしないでディスカバリーする。今回の環境はSoftLayerなのでマルチキャストDNS(mDNS)が通信できるためディスカバリーすることが出来ます。</p>

<p>先に2台とも停止しておく<code>serf leave</code></p>

<pre><code>root@serf1:~# ==&gt; Starting Serf agent...
==&gt; Starting Serf agent RPC...
==&gt; Serf agent running!
         Node name: 'serf1'
         Bind addr: '0.0.0.0:7946'
          RPC addr: '127.0.0.1:7373'
         Encrypted: false
          Snapshot: false
           Profile: lan
      mDNS cluster: serf

==&gt; Log data will now stream in as it occurs:

    2014/08/21 18:46:50 [INFO] agent: Serf agent starting
    2014/08/21 18:46:50 [INFO] serf: EventMemberJoin: serf1 10.114.16.197
    2014/08/21 18:46:51 [INFO] agent: joining: [10.114.16.197:7946] replay: false
    2014/08/21 18:46:51 [INFO] agent: joined: 1 nodes
    2014/08/21 18:46:51 [INFO] agent.mdns: Joined 1 hosts
    2014/08/21 18:46:51 [INFO] agent: Received event: member-join

root@serf1:~# serf members
    2014/08/21 18:47:01 [INFO] agent.ipc: Accepted client: 127.0.0.1:44467
serf1  10.114.16.197:7946  alive
</code></pre>

<p>次にserf2側でも実行</p>

<pre><code>root@serf2:~# ==&gt; Starting Serf agent...
==&gt; Starting Serf agent RPC...
==&gt; Serf agent running!
         Node name: 'serf2'
         Bind addr: '0.0.0.0:7946'
          RPC addr: '127.0.0.1:7373'
         Encrypted: false
          Snapshot: false
           Profile: lan
      mDNS cluster: serf

==&gt; Log data will now stream in as it occurs:

    2014/08/21 18:47:23 [INFO] agent: Serf agent starting
    2014/08/21 18:47:23 [INFO] serf: EventMemberJoin: serf2 10.114.16.196
    2014/08/21 18:47:23 [INFO] agent: joining: [10.114.16.196:7946 10.114.16.197:7946] replay: false
    2014/08/21 18:47:23 [INFO] serf: EventMemberJoin: serf1 10.114.16.197
    2014/08/21 18:47:23 [INFO] agent: joined: 2 nodes
    2014/08/21 18:47:23 [INFO] agent.mdns: Joined 2 hosts
    2014/08/21 18:47:24 [INFO] agent: Received event: member-join

root@serf2:~# serf members
    2014/08/21 18:47:31 [INFO] agent.ipc: Accepted client: 127.0.0.1:48185
serf2  10.114.16.196:7946  alive
serf1  10.114.16.197:7946  alive
</code></pre>

<h1 id="section-3">使い方</h1>

<p>このserfでは<code>Event</code>というものを使って処理ができるようになるのが特徴。その際の処理は<code>Event Handler</code>と言うものが担っている。</p>

<p>EventHander自体は、スクリプト等の実行コマンドで各サーバ上に事前に用意しておく必要がある。したがって複数の処理をしたい場合などはGitなど経由でダウンロードする仕組みを組み込んでいくほうが良いと思われる。</p>

<h2 id="eventhandler">最初に各サーバに最初のEventHandlerのシェルを配置する</h2>

<p>以下の内容で ~/event.sh を作成</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>event.sh </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c">#!/bin/sh </span>
</span><span class="line">
</span><span class="line"><span class="nv">LOG</span><span class="o">=</span>event.log
</span><span class="line">
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;-----&quot;</span> &gt;&gt; <span class="nv">$LOG</span>
</span><span class="line">hostname &gt;&gt; <span class="nv">$LOG</span>
</span><span class="line">date &gt;&gt; <span class="nv">$LOG</span>
</span><span class="line">env <span class="p">|</span>grep <span class="s2">&quot;^SERF&quot;</span> &gt;&gt; <span class="nv">$LOG</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>次に各serfを起動する。一旦<code>serf leave</code>で抜けておいて各サーバで以下のコマンドを実行する。</p>

<p>serf1側を、<code>-role=server</code>として serf2側を <code>-role=agent</code> として起動します。 </p>

<pre><code>serf agent -event-handler=./event.sh -discover=serf -role=&lt;ROLE&gt; &amp;
</code></pre>

<p>これにより、何らかのイベントが発行される都度に <code>event.sh</code>が実行されます。その際の書きだされる内容は</p>

<pre><code>root@serf1:~# tail -f event.log
SERF_EVENT=member-join
SERF_SELF_ROLE=
SERF_SELF_NAME=serf1
-----
serf1
2014年  8月 21日 木曜日 19:16:36 JST
SERF_EVENT=member-join
SERF_SELF_ROLE=server
SERF_TAG_ROLE=server
SERF_SELF_NAME=serf1
    2014/08/21 19:17:08 [INFO] serf: EventMemberLeave: serf2 10.114.16.196
    2014/08/21 19:17:09 [INFO] agent: Received event: member-leave
-----
serf1
2014年  8月 21日 木曜日 19:17:09 JST
SERF_EVENT=member-leave
SERF_SELF_ROLE=server
SERF_TAG_ROLE=server
SERF_SELF_NAME=serf1
    2014/08/21 19:17:27 [INFO] serf: EventMemberJoin: serf2 10.114.16.196
    2014/08/21 19:17:28 [INFO] agent: Received event: member-join
-----
serf1
2014年  8月 21日 木曜日 19:17:28 JST
SERF_EVENT=member-join
SERF_SELF_ROLE=server
SERF_TAG_ROLE=server
SERF_SELF_NAME=serf1
</code></pre>

<p>次に</p>

<pre><code>root@serf2:~# tail -f event.log
SERF_EVENT=member-join
SERF_SELF_ROLE=
SERF_SELF_NAME=serf2
-----
serf2
2014年  8月 21日 木曜日 19:17:28 JST
SERF_EVENT=member-join
SERF_SELF_ROLE=agent
SERF_TAG_ROLE=agent
SERF_SELF_NAME=serf2
</code></pre>

<p>つまり、このEventHandlerのスクリプトをゴニョゴニョすると色々出来ますね。という話です。任意のイベント名を指定して実行してみます。serf2から<code>event TEST</code>を実行します。</p>

<pre><code>root@serf2:~# serf event TEST
</code></pre>

<p>この時、serf1、serf2で同時に event.sh が実行されます。すると</p>

<pre><code>serf1
2014年  8月 21日 木曜日 19:27:16 JST
SERF_EVENT=user
SERF_SELF_ROLE=server
SERF_TAG_ROLE=server
SERF_USER_LTIME=3
SERF_SELF_NAME=serf1
SERF_USER_EVENT=TEST
</code></pre>

<p>のようなイベントな環境変数で実行されます。
これを利用して、XXXサーバ機能として Role/Tag/Serf_Nameを駆使してサーバを特定して特定の処理を実施すると良いことになりますね。</p>

<h1 id="section-4">まとめ</h1>

<p>ざっくり言えば、用意しておいスクリプトをクラスタ環境で実行することが出来る。実行はサーバが起動した際等にmember-joinした際に動くなど、複数のサーバ間で何かの処理をしたい時に同時に実行することが出来るのが面白い。</p>

<p>スクリプトへ渡されるものは、SERF＿EVENTの場合 msmber-* は、標準入力で引き渡されます。その際にはホスト名やIPアドレスを取得することが出来ます。またEventの場合には、引数で指定したデータが渡ります。</p>

<p><a href="http://qiita.com/foostan/items/5d61595b1b331a73b8c9">Dockerで試す、はじめてのSerf - Qiita</a></p>

<p>によるとEventHandlerをイベント事に指定することも出来るようなので色々出来そうです。反面、スクリプトを各サーバに用意しておく必要がありこの部分をプロビジョニング時にうまいことする必要もありそうですね。</p>

<h1 id="section-5">参考</h1>

<ul>
  <li><a href="http://pocketstudio.jp/log3/2014/04/01/serf_event_handlers/">イベントハンドラを整理してみる</a></li>
  <li><a href="http://blog.livedoor.jp/sonots/archives/35397486.html">正月休みだし Serf 触ってみた - sonots:blog</a></li>
</ul>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-08-20T22:45:00+09:00"  data-updated="true" itemprop="datePublished dateCreated">2014年8月20日</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2014/08/20/softlayer-autoscale/" itemprop="url">SoftLayerでのAutoScale機能がリリース</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>SoftLayerにAutoScaleが発表されました。
先日からAPIにはScale関数が登場していたのですがようやく管理ポータル側から設定ができるようになっていました。</p>

<ul>
  <li>この文章はRelease後の検証のため誤りが含まれている可能性がありますのでご注意下さい。</li>
</ul>

<h1 id="section">これは何？</h1>

<p>SoftLayerのAutoScale機能についての説明</p>

<p>AutoScaleでは、トリガーの条件を元にサーバの台数を自動的に増やすことが出来る機能です。</p>

<p>トリガーには</p>

<ul>
  <li>CPU%の値</li>
  <li>毎日の時間</li>
  <li>特定の日時</li>
</ul>

<p>を選択することが出来ます。
またその際に実行できるアクションは</p>

<ul>
  <li>相対的にサーバを増やす（追加台数指定）</li>
  <li>指定の台数にする（固定）</li>
  <li>CPU%を指定する</li>
</ul>

<p>が選択できます。
これによって、朝6時に10台へ夜8時に1台に変更などという事が出来ます。またトリガーは複数選択できるためこの間もCPUに応じてAutoScaleを取ることが出来ます。</p>

<p>またAutoScaleの際には、Local Load Balancer（DataCenter内で利用可能なロードバランサーオプションの名前）に自動的に追加することが可能です。
これ意外にも、「Auto」ではなく「Manual」でスケールさせることも出来ます、これは便利そうです。</p>

<h1 id="section-1">使い方</h1>

<p>管理ポータル上から、<code>Devices</code> → <code>Auto Scale</code> を選択します。なにも設定がないので右上の <code>Add Auto Scale Group</code>より追加を行います。</p>

<p>設定値を記載しておきます。まだ全ての動作を見ていないので不明な箇所は※で記載しておきます。以下の設定をした後に右下の <code>Add Group</code>から構成を追加します。</p>

<h2 id="group-configuration">Group Configuration</h2>

<p>参考 <a href="http://knowledgelayer.softlayer.com/articles/auto-scale-terms">Auto Scale Terms</a></p>

<h3 id="group-details">Group Details</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">分類</th>
      <th style="text-align: left">設定値</th>
      <th style="text-align: left">値</th>
      <th style="text-align: left">補足</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Group Details</td>
      <td style="text-align: left">Group Name</td>
      <td style="text-align: left">グループの名前</td>
      <td style="text-align: left">ユニークになっていれば何でも良いみたい</td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Region</td>
      <td style="text-align: left">地域の選択</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">DataCenter</td>
      <td style="text-align: left">サーバを置くデータセンターを選択</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Termination Policy</td>
      <td style="text-align: left">Closest to next Charge, Newest , Oldest</td>
      <td style="text-align: left">サーバをRemoveする際にどのサーバから消すかの指定</td>
    </tr>
    <tr>
      <td style="text-align: left">Network</td>
      <td style="text-align: left">Private Network Only</td>
      <td style="text-align: left">ON/OFF</td>
      <td style="text-align: left">プライベートのネットワークのみ利用</td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Private (VLAN)</td>
      <td style="text-align: left">VLAN名</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Public (VLAN)</td>
      <td style="text-align: left">VLAN名</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">Group Setting</td>
      <td style="text-align: left">Minimum Member Count</td>
      <td style="text-align: left">最小の起動数</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Maximum Member Count</td>
      <td style="text-align: left">最大の起動数</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">CloodDown Prelod</td>
      <td style="text-align: left">時間(min),Max 10day</td>
      <td style="text-align: left">AutoScale動作後の非監視期間（だと思う）</td>
    </tr>
  </tbody>
</table>

<h3 id="member-configuraion">Member Configuraion</h3>

<p>| 分類 | 設定値 | 値 | 補足 |
|:—-|:——|:–|:—-|</p>

<p>ここは一般的な仮想サーバのパラメータが指定可能、ホスト名とドメイン名が仮に<code>web</code>と<code>autoscale.com</code>だとすると実際にプロビジョニングされる際には<code>web-xxxxxx.autoscale.com</code>のような名称が割り振られる。ここでは <code>Provision Scirpt</code>が指定可能。</p>

<h3 id="policies">Policies</h3>

<p>Policyは何個でも作ることが出来る</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">分類</th>
      <th style="text-align: left">設定値</th>
      <th style="text-align: left">値</th>
      <th style="text-align: left">補足</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Policy Details</td>
      <td style="text-align: left">PolicyName</td>
      <td style="text-align: left">必須</td>
      <td style="text-align: left"> </td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Cooldown Preiod</td>
      <td style="text-align: left">0(min)-10(day)</td>
      <td style="text-align: left">全体の設定を利用するか、個別に作るか</td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: left">Triggers</td>
      <td style="text-align: left">指定</td>
      <td style="text-align: left">CPU%を指定可能( 30%以上や10%以下等,複数組みあせ可能）,特定の曜日, 特定の期間</td>
      <td style="text-align: left"> </td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: left">Action</td>
      <td style="text-align: left">Scale By</td>
      <td style="text-align: left">Exact(固定) , Relative(相対的に), Percentage(%)</td>
      <td style="text-align: left">値は符号なしの場合「増加」、マイナス符号の場合「削減」となる</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="local-load-balancers">Local Load Balancers</h3>

<p>| 分類 | 設定値 | 値 | 補足 |
|:—-|:——|:–|:—-|</p>

<ul>
  <li>あとで時間が有る時に追記する</li>
</ul>

<hr />

<p>Policiesでは、どの様に増やすのかが指定可能です。設定できるLoadBalancersは<code>Local Load Balancers</code>のみですが基本的には問題無いと思います。指定したLBに自動的に組み込みが行われます。</p>

<h1 id="section-2">実験</h1>

<h2 id="section-3">その1</h2>

<p>最初にプロビジョニングされたサーバ上でcpuを100%にするスクリプトを実施</p>

<ul>
  <li>Termination Policy : Newest</li>
  <li>Cooldown Period : 3min</li>
  <li>指定したポリシー：80%以上3分間経過すると「Relatively 1 Members」（相対的に1つ追加）</li>
  <li>LLB: 80番ポート、ヘルスチェックはDefaultを指定</li>
</ul>

<p>この状態でCPUを100%にすることで1台が追加されます。
合計にすると追加後は全体で平均CPU使用率50%(100%+0%)になっているはずです。したがって動きとしては3分後に1台追加 ~~ 、その後 3分で Cooldown し新しい方が消える（Terminate）予定です。 ~~ この設定の場合全体で80%以下になるまで1台づつAutoscaleで増加</p>

<p>結果</p>

<ul>
  <li>3分後に1台が追加</li>
  <li>6分後特に変化なし（2台のまま継続)</li>
  <li>その後経か無いため1台目のCPUを0%に変更</li>
  <li>~~ 30分放置したが結果変わらず ~~ これで正しい</li>
  <li>~~ LogにもCooldownしたとかそういう結果は出てこない（事が正しのか不明だ） ~~ 正しいCooldown経過後の数値はログに出て欲しいが出ない</li>
</ul>

<p>そもそもTerminateの指定は削除の指定であるのか、CPUの使用率は台数分の平均値なのか等が不明。</p>

<h2 id="section-4">その2</h2>

<p>最初にプロビジョニングされたサーバ上でcpuを100%にするスクリプトを実施</p>

<ul>
  <li>Termination Policy : oldest</li>
  <li>Cooldown Period : 3min</li>
  <li>指定したポリシー：30%以上3分間経過すると「Relatively 1 Members」（相対的に1つ追加）</li>
  <li>LLB: 80番ポート、ヘルスチェックはDefaultを指定</li>
</ul>

<p>この状態でCPUを100%に1:することで1台が追加されます。</p>

<p>結果</p>

<ul>
  <li>CPUは平均で30%なのか3までAutoScaleで起動、ログからは13分単位で追加されてる</li>
  <li>これにより監視しているCPUは合計の平均値であることは確実のようです。</li>
  <li>その後変化なし</li>
</ul>

<h2 id="section-5">その3</h2>

<ul>
  <li>Termination Policy : oldest</li>
  <li>Cooldown Period : 3min</li>
  <li>指定したポリシー：30%以下3分間経過すると「Relatively -1 Members」（相対的に1つ削減）</li>
  <li>LLB: 80番ポート、ヘルスチェックはDefaultを指定</li>
</ul>

<p>前提として「その2」の状態である</p>

<p>結果</p>

<ul>
  <li>CPUの使用を0.x%にする</li>
  <li>その後1台づつ terminate policyに従い削除される</li>
</ul>

<h1 id="section-6">まとめ</h1>

<ul>
  <li>一番最初上手くCPUを100にしても動いていませんでしたがその後動きました。Nimsoftは導入されていない状態のサーバがデプロイされています(CentOS)</li>
  <li>~~ 2014/08/21 増えたサーバの「始末」をどうするのか？Termination Policy動いている？よくわからない ~~</li>
  <li>問題なく増加、削除が可能である</li>
  <li>トリガー条件でスケジュールベースが選択できることは便利</li>
  <li>監視トリガーで全体で%の指定が可能なので余力を常に確保するようにAutoScale出来る</li>
  <li>手動で設定の変更ことなしに「QuickScale」が出来るのは面白い</li>
  <li>Regionの名前が初めて出てきた気がします。香港の場合には「as-hkg-central-1」そしてその中のDataCenter名が「Hong Kong2」という構成ですね。</li>
</ul>

<h1 id="section-7">参考</h1>

<ul>
  <li>@urasoko 氏のレポート：<a href="https://medium.com/@urasoko/softlayer-introduces-auto-scale-f91e0bae2a89">SoftLayer Introduces Auto Scale — Medium</a>
  こちらを見ると色々Linkがありました。珍しくAutoScaleはドキュメントがあるなぁ。</li>
</ul>

</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/posts/2">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next disabled"><a href="#">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2016/03/29/try-ducksh/">CyberduckのCli版duckを利用して簡単にクラウドストレージを利用する</a>
    
    <a class="list-group-item " href="/blog/2016/03/28/test/">ATOMエディタからOctopressを利用する</a>
    
    <a class="list-group-item " href="/blog/2016/03/27/bluemix-cli/">Bluemix-cli</a>
    
    <a class="list-group-item " href="/blog/2014/11/04/vyatta2vyos/">Vyatta を VyOS にアップデートして Vxlan を利用する</a>
    
    <a class="list-group-item " href="/blog/2014/11/04/sl-docker/">SoftlayerのslコマンドのDocker化</a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">寄稿</h3>
  </div>
  <div class="list-group">
  	    <a class="list-group-item " href="http://c.af.moshimo.com/af/c/click?a_id=187314&p_id=170&pc_id=185&pl_id=4062&s_v=b5Rz2P0601xu&url=http%3A%2F%2Fwww.amazon.co.jp%2Fexec%2Fobidos%2FASIN%2FB00M7AWOJQ%2Fref%3Dnosim"><img src="http://ecx.images-amazon.com/images/I/51f%2BNfl-h-L._SL160_.jpg" style="border: none;" />
  	    <div>Software Design (ソフトウェア デザイン) 2014年 09月号 [雑誌]</div></a>
  </div>
</section>





<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/blog/categories/info/index.html">
        <span class="badge">1</span>
        info
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/review/index.html">
        <span class="badge">24</span>
        review
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/think/index.html">
        <span class="badge">1</span>
        think
      </a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Tag Cloud</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/blog/tags/octopress/index.html">
        <span class="badge">2</span>
        octopress
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/markdown/index.html">
        <span class="badge">2</span>
        markdown
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/vim/index.html">
        <span class="badge">1</span>
        vim
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/github/index.html">
        <span class="badge">1</span>
        github
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/softlayer/index.html">
        <span class="badge">10</span>
        softlayer
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/redmine/index.html">
        <span class="badge">2</span>
        redmine
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/mkdocs/index.html">
        <span class="badge">1</span>
        mkdocs
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/aws/index.html">
        <span class="badge">1</span>
        AWS
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/mailman/index.html">
        <span class="badge">1</span>
        mailman
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/postfix/index.html">
        <span class="badge">1</span>
        postfix
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/nginx/index.html">
        <span class="badge">1</span>
        nginx
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/tmux/index.html">
        <span class="badge">1</span>
        tmux
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/iterm/index.html">
        <span class="badge">1</span>
        iterm
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/ansbile/index.html">
        <span class="badge">1</span>
        ansbile
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/docker/index.html">
        <span class="badge">1</span>
        docker
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/digitalocean/index.html">
        <span class="badge">1</span>
        digitalocean
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/serf/index.html">
        <span class="badge">1</span>
        serf
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/wordpress/index.html">
        <span class="badge">1</span>
        wordpress
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/vyatta/index.html">
        <span class="badge">1</span>
        vyatta
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/bluemix/index.html">
        <span class="badge">1</span>
        bluemix
      </a>
    
    
    <a class="list-group-item " href="/blog/tags/atom/index.html">
        <span class="badge">1</span>
        atom
      </a>
    
  </div>
</section>


      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2016 - H.Tokida<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'roguer';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


  </body>
</html>
